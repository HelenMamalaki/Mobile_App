<!DOCTYPE html>
<html>

  <head>
    <title>Patient Questionnaire</title>
    <meta charset=utf-8 />
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<!--My Own CSS-->
    <link rel="stylesheet" href="themes/formatting.css" />
    <!--JQuery Mobile CSS-->
    <link rel="stylesheet" href="themes/MyTheme.css" />
    <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
    <!--<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>-->
	<!--JQuery Mobile JavaScript-->
    <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    <!--External scripts needed for date-picker-->
    <link rel="stylesheet" href="http://code.jquery.com/mobile/git/jquery.mobile-git.css" />
    <link rel="stylesheet" href="https://rawgithub.com/arschmitz/jquery-mobile-datepicker-wrapper/master/jquery.mobile.datepicker.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="https://rawgithub.com/jquery/jquery-ui/1-10-stable/ui/jquery.ui.datepicker.js"></script>
    <script src="http://code.jquery.com/mobile/git/jquery.mobile-git.js"></script>
    <script src="https://rawgithub.com/arschmitz/jquery-mobile-datepicker-wrapper/master/jquery.mobile.datepicker.js"></script>
    <!--Extrenal scripts needed for knockout library-->
    <script type='text/javascript' src='knockout-3.1.0.js'></script>
	<!--External scripts needed for imagemapster plugin-->
	<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>-->
	<script src="jquery.imagemapster.js"></script>
	<script>
	var picture=['jackOfDiamonds.gif','queenOfClubs.jpg']; //'kingOfClubs.jpg'
	var rand1 = Math.floor(Math.random()*picture.length);
	var rand2 = Math.floor(Math.random()*picture.length);
	
      window.onload = function(){
	 $('#card1').css("background-image", "url('themes/myImages/card_back.jpg')");
	 $('#card2').css("background-image", "url('themes/myImages/card_back.jpg')");
	// $("#wrapper").html("#1 rand: " + rand1+" #2 rand: " + rand2);
}
	
	</script>
  </head>

  <body>
   <div data-role="page" id="Snap" data-theme="d">
      <div data-role="header">
        <h1>Patient Survey; Snap!</h1>
      </div>
      <div data-role="main" class="ui-content">
	<div id='anywhere'>
        <img src="themes/myImages/NHSlogo.jpg" alt="NHS Scotland" width="85" height="52" id="nhsLogo">
       <h1> This is a game called "Snap"</h1>
	<div class="ui-grid-b">
	<div class="ui-block-a" style="width: 20%; margin-left: 35%;">
		<button type="button" id="card1" class='snap'></button>
	</div> 
	<div class="ui-block-b" style="width: 20%; margin-left: 0%;">
		<button type="button" id="card2" class='snap'></button>
	</div>
	</div><!-- /grid-a -->
	<div id='snapWrapper'>
	</div>
	<div id='score'>
	</div>
	</div>	
	<p>DEBUG: <pre data-bind="text: ko.toJSON($data,null,2)"></pre>	</p>
					
	<a data-role="button" id="nextButton" href="#" onclick="nextPage()"></a>
    </div><!--main content-->
      <div data-role="footer" data-position="fixed">
        <h2>&copy; Edinburgh University 2014</h2>
      </div>
</div> <!--close anywhere-->
	</div><!--End of SnapPage-->
	

	
	<script type='text/javascript'> 
	var card1url;
	var card2url;
	var url1;
	var url2;
	var clicked=false;
	var score=[];
 	var index=0;
	var t0;
     	var t1;
	

	var round=1;
	

	function recursiveTimer(round)
	{
		var interval = setInterval(function(){
			  t0 = '';
     			  t1 = '';
			round += 1;

	    		if(round == 13)
			{
				clearInterval(interval);
				
				alert('Game Over! Your average reaction time was '+ computeAvg());
			}else if(clicked)
			{
	       			clearInterval(interval);
				setTimeout(function(){   		
				clicked=false;
				recursiveTimer(round-1);
				}, 700);
			
	   		}else{
	   		
			rand1 = Math.floor(Math.random()*picture.length);
			rand2 = Math.floor(Math.random()*picture.length);
			$('#card1').css("background-image", "url('themes/myImages/"+picture[rand1]+"')");
			$('#card2').css("background-image", "url('themes/myImages/"+picture[rand2]+"')");
			t0 = Date.now();
			$("#snapWrapper").html(" ");
			}
		
		}, 2000); 
	}//recursiveTimer	


	$(function() {
	   
	$("#score").append("Reaction time: "); 
	    recursiveTimer(round);	
	    $(document).on('click', function(e) {
	        t1 = Date.now();
		clicked=true;
		card1url = $('#card1').css('background-image');	
		card2url = $('#card2').css('background-image'); 

		url1 = card1url.split("myImages/"); 
		url2 = card2url.split("myImages/");
		   
   
		if(url1[1]==url2[1])
		{
			var rt = t1-t0;				
			score.push(rt); 
			//alert(score + 'ms');	
			$("#score").append("<br> "+score[index]+'ms');
			index++;
			$("#snapWrapper").append(" <br> <span style='position:relative;left:45%;top:15%font-weight:bold;font-size:80px;color:#0DBA47;'>Snap!</span>");			
			setTimeout(function(){   		
				//allow time for participant to register visual feedback
			}, 1000);
		
		}else 
		{
			$("#snapWrapper").append("<br> <span style='position:relative;left:49%;top:15%font-weight:bold;font-size:83px;color:#F5033B;'>X</span>");
			
		};		
	       
	    })
	});

	function computeAvg()
	{
		var total=0;
		for(i=0; i<score.length; i++)
		{
			total=total+score[i];
		}

	return total/score.length;
	
	}

		
 
	</script>
  </body>
  </html>			